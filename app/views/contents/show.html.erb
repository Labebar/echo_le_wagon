<div class="container" data-controller="toggle-section">

  <%# section image et video %>
  <% if @content.thumbnail.present? %>
    <%= image_tag @content.thumbnail,
                  class: "img-fluid",
                  data: { action: "click->toggle-section#toggle", target_id: "video-section" },
                  style: "cursor: pointer;" %>
  <% end %>

  <h1><%= @content.name %></h1>

  <div id="video-section" data-toggle-section-target="section" style="display: none;">
    <% if (src = youtube_embed_url(@content.url)) %>
      <div class="video-container">
        <iframe
          src="<%= src %>"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen>
        </iframe>
      </div>
      <p><em>Durée : <%= format_duration(@content.duration) %></em></p>
      <!-- BOUTON POUR REVENIR À L'IMAGE -->
      <%= button_tag "← Retour", type: "button", class: "btn btn-secondary mt-3", data: { action: "click->toggle-section#hide", target_id: "video-section" } %>
    <% else %>
      <p>Impossible d’extraire l’ID YouTube depuis l’URL !</p>
    <% end %>
  </div>

  <div>
    <p>Language <strong><%= @content.language %></strong></p>
    <p>This content is <%= @content.duration %> min long</p>

    <%= link_to 'EDIT', edit_content_path(@content), class: 'custom-button' %>

    <!-- Boutons -->
    <%= button_tag 'SUMMARY', type: 'button', class: 'custom-button', data: { action: "toggle-section#toggle", target_id: "summary-section" } %>
    <%= button_tag 'QUIZZ', type: 'button', class: 'custom-button', data: { action: "toggle-section#toggle quiz-loader#startQuiz", target_id: "quizz-section" } %>
    <%= button_tag 'ASK IA', type: 'button', class: 'custom-button', data: { action: "toggle-section#toggle", target_id: "#" } %>
    <%= button_tag 'NOTES', type: 'button', class: 'custom-button', data: { action: "toggle-section#toggle", target_id: "#" } %>
  </div>

  <!-- Résumé -->
  <div id="summary-section" class="summary-text" data-toggle-section-target="section" style="display: none;">
    <h1><%= @content.name %></h1>
    <%= raw @content.summary[7..-4] if @content.summary %>
  </div>

  <!-- QUIZZ Dynamique -->
  <div id="quizz-section"
       data-controller="quiz-loader"
       data-quiz-loader-url-value="<%= generate_question_content_path(@content) %>"
       data-toggle-section-target="section"
       style="display: block;">
    <h2>Quiz questions</h2>
    <div id="quiz-container"></div>
    <div class="mt-3">
      <button data-action="quiz-loader#generateQuestion" class="btn btn-primary">Next Question</button>
    </div>
  </div>

</div>
