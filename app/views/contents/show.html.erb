<div class="container" data-controller="toggle-section">


  <%# section image et video %>
  <div id="video-wrapper">
    <%= image_tag @content.thumbnail, id: "video-thumbnail", class: "img-fluid", onclick: "showVideo()" if @content.thumbnail.present? %>
  </div>
  <h1><%= @content.name %></h1>
  <p><em>Durée : <%= format_duration(@content.duration) %></em></p>
    <script>
      const thumbnailHtml = `<img src="<%= @content.thumbnail %>" id="video-thumbnail" class="img-fluid" onclick="showVideo()">`;
      const videoHtml = `
        <iframe class="img-fluid" src="<%= youtube_embed_url(@content.url) %>" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        <br>
        <button onclick="showThumbnail()" style="margin-top: 10px;" class="btn btn-secondary">Close</button>`;
      function showVideo() {
        document.getElementById("video-wrapper").innerHTML = videoHtml;
      }
      function showThumbnail() {
        document.getElementById("video-wrapper").innerHTML = thumbnailHtml;
      }
    </script>

  <p>Language <strong><%= @content.language %></strong></p>
  <p>This content is <%= @content.duration %> min long</p>

  <%= link_to 'EDIT', edit_content_path(@content), class: 'custom-button' %>
  <!-- Section bouton -->
  <%= button_tag 'SUMMARY', type: 'button', class: 'custom-button', data: { action: "toggle-section#toggle", target_id: "summary-section" } %>
  <%= button_to 'QUIZZ', generate_question_content_path(@content), method: :post, class: 'custom-button' %>
  <%= button_tag 'ASK IA', type: 'button', class: 'custom-button', data: { action: "toggle-section#toggle", target_id: "#" } %>
  <%= button_tag 'NOTES',   type: 'button', class: 'custom-button', data: { action: "toggle-section#toggle", target_id: "#" } %>

  <!-- Sections -->
  <div id="summary-section" class="summary-text" data-toggle-section-target="section" style="display: none;">
    <h1> <%= @content.name %></h1>
    <%= raw @content.summary[7..-4] %>
  </div>

  <div id="quizz-section" data-toggle-section-target="section" style="<%= params[:quizz] ? 'display: block;' : 'display: none;' %>">
    <h2>Quiz questions</h2>

    <% @questions.each_with_index do |question, index| %>
      <div
        data-controller="reveal-answer"
        data-reveal-answer-index-value="<%= index %>"
        class="question-block"
        style="margin-bottom: 30px; display: <%= index == 0 ? 'block' : 'none' %>;">

        <p><strong><%= question.statement %></strong></p>

        <% answers = [question.answer_1, question.answer_2, question.answer_3, question.answer_true].shuffle %>
        <% answers.each do |answer| %>
          <button
            type="button"
            class="answer-button"
            data-action="reveal-answer#select"
            data-correct-answer="<%= question.answer_true %>">
            <%= answer %>
          </button>
        <% end %>

        <p data-reveal-answer-target="explanation" style="display: none; margin-top: 10px;">
          ✅ <strong>Explication :</strong> <%= question.explanation %>
        </p>

        <button
          data-action="reveal-answer#nextQuestion"
          data-reveal-answer-target="nextButton"
          style="display: none; margin-top: 10px;">
          Next Question
        </button>

        <button
          data-action="reveal-answer#retry"
          data-reveal-answer-target="retryButton"
          style="display: none; margin-top: 10px; margin-left: 10px;">
          Retry Question
        </button>
      </div>
    <% end %>
  </div>
</div>
</div>
